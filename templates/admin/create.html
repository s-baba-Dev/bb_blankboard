{% extends "base_admin.html" %}

{% block title %}新規投稿 - 管理者{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">新規投稿</h1>

<div class="bg-white p-8 rounded-lg shadow">
    <form action="/admin/posts/new" method="post">

        <label class="block font-semibold mb-2">タイトル</label>
        <input type="text" name="title" required
               class="w-full border border-gray-300 rounded px-3 py-2 mb-6">

        <label class="block font-semibold mb-2">本文</label>

        <div id="editor" class="mb-6"></div>

        <input type="hidden" name="content" id="content-hidden">

        <button type="submit"
                class="px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700">
            投稿する
        </button>
    </form>
</div>

<a href="/admin/posts" class="text-blue-500 hover:text-blue-400 mt-6 block">← 一覧に戻る</a>

<!-- ===== Toast UI Editor JS ===== -->
<script src="https://uicdn.toast.com/editor/3.1.2/toastui-editor-all.min.js"></script>

<!-- Color Picker -->
<script src="https://uicdn.toast.com/tui-color-picker/latest/tui-color-picker.min.js"></script>

<!-- ★ これが無いと絶対動かない Color Syntax プラグイン -->
<script src="https://uicdn.toast.com/editor-plugin-color-syntax/latest/toastui-editor-plugin-color-syntax.min.js"></script>

<script>
    const editor = new toastui.Editor({
        el: document.querySelector('#editor'),
        height: '600px',
        initialEditType: 'wysiwyg',   // ← これでOK
        previewStyle: 'vertical',     // これは無視される（仕様）
        plugins: [toastui.Editor.plugin.colorSyntax]
    });

    document.querySelector("form").addEventListener("submit", () => {
        document.querySelector("#content-hidden").value = editor.getMarkdown();
    });
</script>

{% endblock %}
